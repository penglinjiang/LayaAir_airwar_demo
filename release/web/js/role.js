var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function o(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),Role=function(t){function i(){var i=t.call(this)||this;return i.hp=0,i.speed=0,i.shootInterval=300,i.shootTime=300,i.isBullet=!1,i.propType=0,i.bulletLevel=0,i.shootNum=1,i.bulletPos=[[0],[-15,15],[-30,0,30],[-45,-15,15,45]],i.roleAni=new laya.display.Animation,i.roleAni.loadAnimation("GameRole.ani"),i}return __extends(i,t),i.prototype.init=function(t,i,e,o,s){this.type=t,this.hp=i,this.speed=e,this.hitRadius=o,this.camp=s,this.isBullet=!1,this.propType=0,this.shootNum=1,this.bulletLevel=0,this.addChild(this.roleAni),this.roleAni.on(Laya.Event.COMPLETE,this,this.onComplete),this.playAction("fly")},i.prototype.playAction=function(t){this.action=t,this.roleAni.play(0,!0,this.type+"_"+this.action)},i.prototype.update=function(){this.visible?(this.y+=this.speed,"hero"!==this.type&&(this.y>1380||this.y<-150)&&(this.visible=!1,this.type.indexOf("enemy")>=0&&GameMain.miss++),"hero"===this.type&&(GameMain.miss>=5&&(console.log("gameMiss: ",GameMain.miss),this.hp--,GameMain.miss=0),this.x<this.roleAni.width/2?this.x=this.roleAni.width/2:this.x>720-this.roleAni.width/2&&(this.x=720-this.roleAni.width/2),this.y<this.roleAni.height/2?this.y=this.roleAni.height/2:this.y>1280-this.roleAni.height/2&&(this.y=1280-this.roleAni.height/2))):"hero"!==this.type&&this.die()},i.prototype.die=function(){this.roleAni.stop(),this.roleAni.offAll(),this.removeSelf(),laya.utils.Pool.recover("role",this)},i.prototype.lostHp=function(t){this.hp-=t,this.hp>0?(this.playAction("hit"),"hero"===this.type&&laya.media.SoundManager.playSound("sound/hero_hurt.mp3")):this.isBullet?this.visible=!1:(this.playAction("die"),"hero"===this.type||this.isBullet||GameMain.score++,"hero"===this.type?laya.media.SoundManager.playSound("sound/game_over.mp3"):laya.media.SoundManager.playSound("sound/enemy1_die.mp3"))},i.prototype.onComplete=function(){if(0===this.roleAni.width){var t=this.roleAni.getBounds();this.roleAni.size(t.width,t.height)}"die"===this.action?(this.visible=!1,this.lostProp()):"hit"===this.action&&this.playAction("fly")},i.prototype.shoot=function(){var t=laya.utils.Browser.now();if(t>this.shootTime)for(var e=this.bulletPos[this.shootNum-1],o=0;o<e.length;o++){this.shootTime=t+this.shootInterval;var s=laya.utils.Pool.getItemByClass("role",i);s.init("bullet2",1,-10,1,this.camp),s.isBullet=!0,s.visible=!0,s.pos(this.x+e[o],this.y-80),this.parent.addChild(s),laya.media.SoundManager.playSound("sound/bullet.mp3")}},i.prototype.lostProp=function(){if("enemy3"===this.type){var t=laya.utils.Pool.getItemByClass("role",i),e=Math.random()<.7?1:2;t.init("ufo"+e,1,2,30,1),t.propType=e,t.visible=!0,t.pos(this.x,this.y),this.parent.addChild(t)}},i.prototype.eatProp=function(t){"hero"===this.type&&0!==t.propType&&(laya.media.SoundManager.playSound("sound/achievement.mp3"),1===t.propType?(GameMain.score++,this.bulletLevel++,this.shootNum=Math.min(Math.floor(this.bulletLevel/2)+1,4),this.shootInterval=300-8*(this.bulletLevel>8?8:this.bulletLevel)):2===t.propType&&(this.hp+=2,GameMain.score++),t.hp=0,t.visible=!1)},i}(laya.display.Sprite);