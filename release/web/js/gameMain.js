var GameMain=function(){function e(){this.hp=10,this.level=1,this.hps=[1,6,15],this.nums=[2,1,1],this.speeds=[3,2,1],this.radius=[20,35,80],this.deathTime=0,this.createTime=0,this.speedUp=0,this.hpUp=0,this.numUp=0,this.levelUpScore=50,Laya.init(720,1280,Laya.WebGL),Laya.stage.scaleMode=Laya.Stage.SCALE_EXACTFIT,Laya.loader.load("res/atlas/gameUI.atlas",Laya.Handler.create(this,this.gameStart))}return e.prototype.gameStart=function(){this.start=new GameStart,this.start.popup(),this.start.btn_start.on(Laya.Event.MOUSE_UP,this,this.gameInit)},e.prototype.gameInit=function(){this.level=1,this.createTime=0,this.speedUp=0,this.hpUp=0,this.numUp=0,this.levelUpScore=50,e.score=0,e.miss=0,this.start.close(),this.map=this.map||new GameMap,Laya.stage.addChild(this.map),this.roleLayer=this.roleLayer||new laya.display.Sprite,Laya.stage.addChild(this.roleLayer),this.hero=this.hero||new Role,this.hero.init("hero",10,0,30,0),this.hero.visible=!0,this.hero.pos(360,800),this.roleLayer.addChild(this.hero),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onMouseUp),this.play=this.play||new GamePlay,Laya.stage.addChild(this.play),Laya.timer.frameLoop(1,this,this.loop)},e.prototype.onMouseDown=function(){this.moveX=Laya.stage.mouseX,this.moveY=Laya.stage.mouseY,Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.onMouseMove)},e.prototype.onMouseMove=function(){var e=this.moveX-Laya.stage.mouseX,t=this.moveY-Laya.stage.mouseY;this.hero.x-=e,this.hero.y-=t,this.moveX=Laya.stage.mouseX,this.moveY=Laya.stage.mouseY},e.prototype.onMouseUp=function(){Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.onMouseMove)},e.prototype.gameOver=function(){Laya.stage.offAll(),this.map.removeSelf(),this.play.removeSelf(),this.roleLayer.removeChildren(0,this.roleLayer.numChildren-1),this.roleLayer.removeSelf(),Laya.timer.clear(this,this.loop),this.over=this.over||new GameOver,this.over.txt_score.text=e.score.toString(),this.over.popup(),this.over.on("reStart",this,this.gameInit)},e.prototype.loop=function(){if(this.map.updateMap(),this.play.update(this.hero.hp,this.level,e.score),this.hero.hp<=0){if(this.deathTime++,this.deathTime>=100)return this.deathTime=0,void this.gameOver()}else this.hero.shoot(),this.levelUp();for(var t=this.roleLayer.numChildren-1;t>=0;t--){var s=this.roleLayer.getChildAt(t);if(s.update(),!(s.hp<=0))for(var a=t-1;a>=0;a--){var i=this.roleLayer.getChildAt(a);if(i.hp>0&&i.camp!==s.camp){var h=s.hitRadius+i.hitRadius;Math.abs(s.x-i.x)<h&&Math.abs(s.y-i.y)<h&&(0!==s.propType||0!==i.propType?(s.eatProp(i),i.eatProp(s)):(s.lostHp(1),i.lostHp(1)))}}}Laya.timer.currFrame%(80-this.createTime)==0&&this.createEnemy(0,this.hps[0],this.speeds[0]+this.speedUp,this.nums[0]+this.numUp),Laya.timer.currFrame%(170-2*this.createTime)==0&&this.createEnemy(1,this.hps[1]+2*this.hpUp,this.speeds[1]+this.speedUp,this.nums[1]),Laya.timer.currFrame%(1e3-3*this.createTime)==0&&this.createEnemy(2,this.hps[2]+6*this.hpUp,this.speeds[2],this.nums[2]+this.numUp)},e.prototype.createEnemy=function(e,t,s,a){for(var i=0;i<a;i++){var h=laya.utils.Pool.getItemByClass("role",Role);h.init("enemy"+(e+1),t,s,this.radius[e],1),h.visible=!0,h.pos(640*Math.random()+50,100*-Math.random()),this.roleLayer.addChild(h)}},e.prototype.levelUp=function(){e.score>this.levelUpScore&&(this.level++,this.hero.hp=Math.min(this.hero.hp+1*this.level,15),this.createTime=this.level<30?2*this.level:60,this.speedUp=Math.floor(this.level/6),this.hpUp=Math.floor(this.level/8),this.numUp=Math.floor(this.level/10),this.levelUpScore+=50,laya.media.SoundManager.playSound("sound/level_update.mp3"))},e.score=0,e.miss=0,e}();new GameMain;