var Browser=laya.utils.Browser,Composite=Matter.Composite,Events=Matter.Events,Bounds=Matter.Bounds,Common=Matter.Common,Vertices=Matter.Vertices,Vector=Matter.Vector,Sleeping=Matter.Sleeping,Axes=Matter.Axes,Body=Matter.Body,SAT=Matter.SAT,Contact=Matter.Contact,Pair=Matter.Pair,Detector=Matter.Detector,Grid=Matter.Grid,LayaRender={};!function(){var e,t,r;LayaRender.create=function(o){var n={controller:LayaRender,element:null,canvas:null,mouse:null,options:{width:800,height:600,pixelRatio:1,background:"#fafafa",wireframeBackground:"#222",hasBounds:!!o.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},a=Common.extend(n,o);return a.canvas=laya.renders.Render.canvas,a.context=laya.renders.Render.context.ctx,a.textures={},a.bounds=a.bounds||{min:{x:0,y:0},max:{x:Laya.stage.width,y:Laya.stage.height}},function(o){var n=o.container;t=new Laya.Sprite,r=new Laya.Sprite,o.spriteContainer=t,o.graphicsContainer=r,n.addChild(t),n.addChild(r),e=r.graphics}(a),function(e){var r=e.options.background;7==r.length&&"#"==r[0]?t.graphics.drawRect(0,0,e.options.width,e.options.height,r):t.loadImage(r)}(a),Laya.Render.canvas.setAttribute("data-pixel-ratio",1),a},LayaRender.world=function(t){var r,o=t.render,n=t.world,a=o.options,i=Composite.allConstraints(n),s=Composite.allBodies(n),d=[];if(a.hasBounds){var p=o.bounds.max.x-o.bounds.min.x,l=o.bounds.max.y-o.bounds.min.y;a.width,a.height;for(r=0;r<s.length;r++){var c=s[r];c.render.sprite.visible=Bounds.overlaps(c.bounds,o.bounds)}for(r=0;r<i.length;r++){var h=i[r],u=h.bodyA,y=h.bodyB,v=h.pointA,w=h.pointB;u&&(v=Vector.add(u.position,h.pointA)),y&&(w=Vector.add(y.position,h.pointB)),v&&w&&((Bounds.contains(o.bounds,v)||Bounds.contains(o.bounds,w))&&d.push(h))}}else d=i;for(e.clear(),r=0;r<s.length;r++)LayaRender.body(t,s[r]);for(r=0;r<d.length;r++)LayaRender.constraint(t,d[r])},LayaRender.body=function(r,o){var n=r.render,a=o.render;if(a.visible){var i=a.sprite,s=o.sprite;if(a.sprite&&a.sprite.texture)s||(s=o.sprite=function(e,r){var o=new Laya.Sprite;return o.pivot(e,r),o.pos(-9999,-9999),t.addChild(o),o}(i.xOffset,i.yOffset)).loadImage(i.texture),s.scale(i.xScale,i.yScale),s.pos(o.position.x,o.position.y),s.rotation=180*o.angle/Math.PI;else{var d=n.options;for(k=o.parts.length>1?1:0;k<o.parts.length;k++)if(part=o.parts[k],part.render.visible){var p=d.wireframes?null:part.render.fillStyle,l=part.render.lineWidth,c=part.render.strokeStyle;if(part.circleRadius)e.drawCircle(part.position.x,part.position.y,part.circleRadius,p,c,l);else{var h=[];h.push(part.vertices[0].x,part.vertices[0].y);for(var u=1;u<part.vertices.length;u++)!part.vertices[u-1].isInternal||showInternalEdges,h.push(part.vertices[u].x,part.vertices[u].y),part.vertices[u].isInternal&&!showInternalEdges&&h.push(part.vertices[(u+1)%part.vertices.length].x,part.vertices[(u+1)%part.vertices.length].y);e.drawPoly(0,0,h,p,c,l)}}}}},LayaRender.constraint=function(t,r){var o,n,a,i;if(r.render.visible&&r.pointA&&r.pointB){var s=r.bodyA,d=r.bodyB;s?(o=s.position.x+r.pointA.x,n=s.position.y+r.pointA.y):(o=r.pointA.x,n=r.pointA.y),d?(a=d.position.x+r.pointB.x,i=d.position.y+r.pointB.y):(a=r.pointB.x,i=r.pointB.y),e.drawLine(o,n,a,i,r.render.strokeStyle,r.render.lineWidth)}}}();